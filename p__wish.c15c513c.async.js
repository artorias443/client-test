(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{"1wSI":function(e,t,a){e.exports={wishScanPage:"antd-pro-components-wish-scan-index-wishScanPage",wishScanTitle:"antd-pro-components-wish-scan-index-wishScanTitle",wishScanBody:"antd-pro-components-wish-scan-index-wishScanBody",scanBox:"antd-pro-components-wish-scan-index-scanBox",wishScanFooter:"antd-pro-components-wish-scan-index-wishScanFooter",scanTip:"antd-pro-components-wish-scan-index-scanTip",scanErr:"antd-pro-components-wish-scan-index-scanErr",htmlBtnBox:"antd-pro-components-wish-scan-index-htmlBtnBox",htmlBtn:"antd-pro-components-wish-scan-index-htmlBtn",htmlbtnTip:"antd-pro-components-wish-scan-index-htmlbtnTip",wishUkeyPage:"antd-pro-components-wish-scan-index-wishUkeyPage",pinForm:"antd-pro-components-wish-scan-index-pinForm",errFormItem:"antd-pro-components-wish-scan-index-errFormItem",editPwd:"antd-pro-components-wish-scan-index-editPwd",iframe:"antd-pro-components-wish-scan-index-iframe",cloudErr:"antd-pro-components-wish-scan-index-cloudErr",errorImg:"antd-pro-components-wish-scan-index-errorImg"}},AMnf:function(e,t,a){"use strict";a.r(t);var n=a("q1tI"),s=a.n(n),r=a("9kvl"),i=a("Ty5D"),c=a("cOft"),o=a.n(c),l=(a("+L6B"),a("2/Rp")),u=(a("sRBo"),a("kaz8")),p=(a("5NDa"),a("5rEg")),d=a("qLMh"),m=a("9og8"),w=(a("y8nQ"),a("Vl3Y")),h=a("tJVT"),b=a("1wSI"),f=a.n(b),j=a("D1Df"),g=a.n(j),O=a("L2qd"),S=a("xqX8"),y=a("+n12"),I=a("z0WU"),E=a("biJ1"),v=a.n(E),T=a("JYHG"),x=a("Tex+"),N=a("+JY7"),C=a("0OBr"),k=void 0,M=function(e){var t=e.dispatch,a=e.state,r=e.location,i=r.pathname,c=r.query;c=Object(I["k"])(c);var o=a.wishUrl,b=a.wishResult,j=a.reMark,E=Object(I["g"])(),M=i.match(/\/(\S*)\//)[1];if("0"===M&&(M=localStorage.getItem("surredClientCode"),-1!=location.href.indexOf("/0/"))){var P=location.href.split("/0/");location.replace("".concat(P[0],"/").concat(M,"/").concat(P[1]))}localStorage.getItem("surredClientCode")&&(M=localStorage.getItem("surredClientCode"));var U=Object(n["useState"])(0),_=Object(h["a"])(U,2),A=_[0],D=_[1],F=Object(n["useState"])("e\u7b7e\u76fe"),L=Object(h["a"])(F,2),R=L[0],B=L[1],G=Object(n["useState"])(null),K=Object(h["a"])(G,2),J=K[0],V=K[1],Y=Object(n["useRef"])(),H=Object(n["useRef"])(),q=w["a"].useForm(),z=Object(h["a"])(q,1),W=z[0],X=Object(n["useState"])(null),Q=Object(h["a"])(X,2),Z=Q[0],$=Q[1],ee=Object(n["useState"])(!1),te=Object(h["a"])(ee,2),ae=te[0],ne=te[1],se=Object(n["useState"])(null),re=Object(h["a"])(se,2),ie=re[0],ce=re[1],oe=Object(n["useState"])(null),le=Object(h["a"])(oe,2),ue=le[0],pe=le[1],de=Object(n["useState"])(null),me=Object(h["a"])(de,2),we=me[0],he=me[1],be=Object(n["useRef"])(""),fe=JSON.parse(localStorage.getItem("sealData")),je=null;if(Array.isArray(fe)){var ge=c.subjectsId||c.subjectId;je=fe.find((function(e){return e.sessionjson.subjectID===ge}))}else je=fe;var Oe=function(){var e=c.subjectId||Object(y["z"])("ukeySubjectId"),t=W.getFieldsValue();c.password&&(t.password=c.password);var a="KG_CLOUD"===c.wishType||"KG_UKEY"===c.wishType?be.current:"";Object(x["J"])(M,c.subjectId,t.remember?a>=1?y["a"].encode(t.password):t.password:"",!1,a),t.password&&Object(x["n"])(M,e,t.password,c.wishType,a).then((function(e){if("success"==e)if($(null),Object(y["vb"])("subjectsId",""),"cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName){var t=localStorage.getItem("ukeySessionjson"),a={sessionjson:JSON.parse(t),wishResult:"0"};eSign.UrlContainer.SetResult(JSON.stringify(a))}else{var n={type:"wish",status:!0};window.parent.postMessage(n,"*")}else $(e)}))},Se=function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(){var t;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(x["y"])(M,c.wishType||"TG_TIMEVALE",c.subjectId,E,"PC",c.willTypes);case 2:t=e.sent,"string"==typeof t?"Token has expired"==t?(clearInterval(H.current),V("\u60a8\u5f53\u524d\u8d26\u53f7\u4e0d\u5b58\u5728\u6216\u5df2\u9000\u51fa\uff0c\u8bf7\u5173\u95ed\u7a97\u53e3\u91cd\u65b0\u7b7e\u7ae0")):V(t):t&&(he(t.data.willID),ce(t.data.url));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(){var t,a;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("TG_TIMEVALE"!==c.wishType){e.next=7;break}return e.next=3,Object(x["x"])(M,"TG_TIMEVALE",we);case 3:t=e.sent,pe(t),e.next=12;break;case 7:if("TG_SAAS"!==c.wishType&&"USP_UKEY"!==c.wishType){e.next=12;break}return e.next=10,Object(N["e"])({clientCode:M,sourceName:c.wishType,willID:we});case 10:a=e.sent,pe(a);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(){var t,a,n;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(y["vb"])("subjectsId",""),"cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName?(t=localStorage.getItem("ukeySessionjson"),a={sessionjson:JSON.parse(t),wishResult:"0"},eSign.UrlContainer.SetResult(JSON.stringify(a))):(n={type:"wish",status:!0},window.parent.postMessage(n,"*"));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n["useEffect"])((function(){Object(m["a"])(Object(d["a"])().mark((function e(){var a,n,s;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(c.baseUrl&&Object(I["s"])(c.baseUrl),c.XServiceAddress&&Object(I["t"])(c.XServiceAddress),"CA_MOBILE"!=c.wishType){e.next=9;break}D(2),a=localStorage.getItem("providerName"),B(a||"e\u7b7e\u76fe"),t({type:"indexPageModel/SetCertifyInfo",payload:{providerName:a,clientCode:M,sourceName:"CA_MOBILE",signType:"131072",hashData:c.hashData||"",sealID:c.sealID||"",subjectID:je?je.subjectID:"",digalMethod:je?je.sessionjson.digalMethod:"",fileName:je?je.sessionjson.fileName:"",hashFormat:je?je.sessionjson.hashFormat:""}}),e.next=36;break;case 9:if("CA_UKEY"!=c.wishType&&"KG_UKEY"!=c.wishType&&"KG_CLOUD"!==c.wishType){e.next=20;break}if(D(1),"KG_CLOUD"!==c.wishType&&"KG_UKEY"!==c.wishType){e.next=16;break}return e.next=14,Object(x["z"])(M,c.wishType,c.signatureMode);case 14:n=e.sent,be.current=null===n||void 0===n?void 0:n.pinmode;case 16:"cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName&&eSign.UrlContainer.SetWidgetVisible(!0),c.password?k.onFinish():Object(x["v"])(M,c.subjectId).then((function(e){e&&(e=y["a"].decode(e),W.setFieldsValue({password:e,remember:!!e}))})),e.next=36;break;case 20:if("USP_UKEY"!==c.wishType){e.next=35;break}return D(5),"cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName&&eSign.UrlContainer.SetWidgetVisible(!0),e.next=25,Object(x["b"])("USP_UKEY",M,"","");case 25:if(s=e.sent,"string"!==typeof s){e.next=29;break}return V(s),e.abrupt("return");case 29:if(0!=s.isLogin){e.next=32;break}return V("\u767b\u5f55\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55"),e.abrupt("return");case 32:"cloud"==s.authorizeMode?Se():Object(x["u"])(M,null,null,"USP_UKEY").then((function(e){if("string"===typeof e)V(e);else{var t=e.find((function(e){return e.subjectID===c.subjectId}));t?Ie():V("\u8bf7\u63d2\u5165\u539f\u59cbUKey,\u7136\u540e\u518d\u8fdb\u884c\u8be5\u64cd\u4f5c\uff01")}})),e.next=36;break;case 35:"TG_TIMEVALE"==c.wishType?(Se(),D(3)):"TG_SAAS"==c.wishType&&(xe(),D(4));case 36:case"end":return e.stop()}}),e)})))()}),[]);var Ee=function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(){return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t({type:"indexPageModel/GetCertifyResult",payload:{clientCode:M,sourceName:"CA_MOBILE"}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n["useEffect"])((function(){"CA_MOBILE"==c.wishType&&(o?Y.current=setInterval((function(){Ee()}),1e3):clearInterval(Y.current))}),[o]),Object(n["useEffect"])((function(){"TG_TIMEVALE"!=c.wishType&&"TG_SAAS"!==c.wishType&&"USP_UKEY"!=c.wishType||(ie?H.current=setInterval((function(){ye()}),1e3):clearInterval(H.current))}),[ie]),Object(n["useEffect"])((function(){if("CA_MOBILE"==c.wishType&&b){if("cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName){var e={wishResult:"0",subjectID:c.subjectsId||c.subjectId,sessionjson:je?je.sessionjson:""};eSign.UrlContainer.SetResult(JSON.stringify(e))}else if("cloudReader"==c.appName||"iSignatureHTML5"==c.appName){var t={type:"wish",status:!0};window.parent.postMessage(t,"*")}clearInterval(Y.current)}}),[b]),Object(n["useEffect"])((function(){if(("TG_TIMEVALE"==c.wishType||"TG_SAAS"==c.wishType||"USP_UKEY"===c.wishType)&&null!=ue)if("string"==typeof ue)V("Token has expired"==ue?"\u60a8\u5f53\u524d\u8d26\u53f7\u4e0d\u5b58\u5728\u6216\u672a\u767b\u5f55\uff0c\u8bf7\u5173\u95ed\u7a97\u53e3\u91cd\u65b0\u7b7e\u7ae0":ue),clearInterval(H.current);else if(1==ue.data.status){je&&je.sessionjson&&(je.sessionjson.pureRsaCertFrom=ue.data.pureRsaCertFrom);var e={wishResult:"0",subjectID:c.subjectsId||c.subjectId,sessionjson:je?je.sessionjson:"",pureRsaCertFrom:ue.data.pureRsaCertFrom};if("TG_SAAS"===c.wishType&&(""===e.sessionjson?e.sessionjson={willID:we,needBilling:!0,subjectID:e.subjectID}:(e.sessionjson.willID=we,e.sessionjson.needBilling=!0,e.sessionjson.subjectID=e.subjectID)),"cloudReader"!=c.appName&&"iSignatureHTML5"!=c.appName)eSign.UrlContainer.SetResult(JSON.stringify(e));else{var t={type:1==c.SignatureMode?"wish":"electSign",status:!0,pureRsaCertFrom:ue.data.pureRsaCertFrom,sessionjson:je?je.sessionjson:""};window.parent.postMessage(t,"*")}clearInterval(H.current)}}),[ue]);var ve=function(e){var t=e.target.value;t||$(null)},Te=function(e){ne(!1),"editSuccess"==e&&(Object(x["J"])(M,c.subjectId,""),W.setFieldsValue({password:""}),W.setFieldsValue({remember:!1}))},xe=function(){var e=Object(m["a"])(Object(d["a"])().mark((function e(){var t;return Object(d["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(N["d"])({clientCode:M,sourceName:"TG_SAAS"});case 2:t=e.sent,"string"===typeof t?V(t):(he(t.data.willID),ce(t.data.url));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return s.a.createElement("div",{className:f.a.wishPage},0===A&&s.a.createElement(S["a"],null),!ae&&s.a.createElement("div",null,1===A&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:f.a.wishUkeyPage},s.a.createElement(w["a"],{form:W,labelCol:{span:6},wrapperCol:{span:18},initialValues:{remember:!1},onFinish:Oe,autoComplete:"off",className:"".concat(f.a.pinForm," wishPinForm")},s.a.createElement(w["a"].Item,{label:"UKey PIN\u7801\uff1a",name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165PIN\u7801"}]},s.a.createElement(p["a"].Password,{onChange:ve,className:f.a.pinInput})),Z&&s.a.createElement(w["a"].Item,{className:"".concat(f.a.errFormItem," wishErrFormItem"),name:"errTip",wrapperCol:{offset:6,span:18}},s.a.createElement("span",null,Z)),s.a.createElement(w["a"].Item,{wrapperCol:{offset:6,span:18}},"KG_CLOUD"!==c.wishType&&s.a.createElement(s.a.Fragment,null,s.a.createElement(w["a"].Item,{name:"remember",valuePropName:"checked"},s.a.createElement(u["a"],null,"\u8bb0\u4f4fPIN\u7801")),s.a.createElement("span",{onClick:function(){ne(!0)},className:f.a.editPwd},"\u4fee\u6539PIN\u7801")),"KG_CLOUD"==c.wishType&&s.a.createElement(w["a"].Item,{name:"remember",valuePropName:"checked",style:{textAlign:"right"}},s.a.createElement(u["a"],null,"\u8bb0\u4f4fPIN\u7801"))))),s.a.createElement("div",{className:f.a.htmlBtnBox},s.a.createElement("span",{className:f.a.htmlbtnTip},"\u8bf7\u6ce8\u610f\uff1a\u5173\u95ed\u6216\u91cd\u542f\u7535\u8111\u540e\u8bb0\u4f4f\u5931\u6548"),s.a.createElement(l["a"],{className:f.a.htmlBtn,type:"primary",onClick:Oe},"\u786e\u5b9a"))),2===A&&s.a.createElement("div",{className:f.a.wishScanPage},s.a.createElement("div",{className:f.a.wishScanTitle},R),s.a.createElement("div",{className:f.a.wishScanBody},s.a.createElement("div",{className:f.a.scanBox},o&&(o.startsWith("http")?s.a.createElement(g.a,{size:160,value:o}):s.a.createElement("img",{style:{width:"200px",height:"200px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},src:"data:image/png;base64,"+o})))),s.a.createElement("div",{className:f.a.wishScanFooter},s.a.createElement("div",{className:f.a.scanTip},j),J&&s.a.createElement("div",{className:f.a.scanErr},J))),(3===A||4===A||5===A)&&s.a.createElement("div",null,!J&&s.a.createElement(C["a"],{className:f.a.iframe,src:ie}),J&&s.a.createElement(T["a"],{src:v.a,text:J,type:"danger",block:!0,customStyle:{paddingTop:"160px"}}))),ae&&s.a.createElement(O["a"],{onshow:Te,pinmode:be.current}))},P=Object(r["a"])((function(e){var t=e.indexPageModel;return{state:t}}))(Object(i["n"])(M)),U=function(e){var t=e.location.query;return document.title="\u610f\u613f\u8ba4\u8bc1",window.onload=function(){},s.a.createElement("div",{className:"CA_MOBILE"==t.wishType?o.a.wishPage:o.a.wishPage2},s.a.createElement(P,null))};t["default"]=Object(r["a"])((function(e){var t=e.indexPageModel;return{state:t}}))(Object(i["n"])(U))},cOft:function(e,t,a){e.exports={wishPage:"antd-pro-pages-wish-index-wishPage",testMsg:"antd-pro-pages-wish-index-testMsg",wishPage2:"antd-pro-pages-wish-index-wishPage2"}}}]);